<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会员档案</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link rel="stylesheet" type="text/css" href="../css/vip_information.css">
    <link rel="stylesheet" type="text/css" href="../css/add_archives.css">
    <style>
        .line_input {
            width: 50px;
        }

        .line_input input {
            border: none;
            border-bottom: 1px solid #dcdfe6;
            border-radius: 0;
            background: transparent;
        }

        .li_input {
            width: 60px;
            margin: 0 10px;
        }
    </style>
</head>
<body class="information">

<div id="app" class="customer">
    <template>
        <p class="cus_title">
            <el-breadcrumb separator-class="el-icon-arrow-right">
                <el-breadcrumb-item :to="{ path: '/' }">仓库管理</el-breadcrumb-item>
                <el-breadcrumb-item>美约会（总仓）</el-breadcrumb-item>
            </el-breadcrumb>
        </p>
        <el-tabs type="card" @tab-click="myClick" class="vip_infor">
            <el-tab-pane label="出入库管理/其他设置">
                <div class="cus_center">
                    <el-input class="cus_seatch" style="float: left"
                              placeholder="请输入内容"
                              prefix-icon="el-icon-search"
                              v-model="input">
                    </el-input>
                    <span>
                            按数量查找：
                        <el-radio v-model="radio" label="1">
                            大于等于
                            <el-input v-model="input" placeholder="" class="line_input"></el-input>个
                        </el-radio>
                        <el-radio v-model="radio" label="2">
                          小于等于
                            <el-input v-model="input" placeholder="" class="line_input"></el-input>个
                      </el-radio>
                        </span>
                    <el-button type="success" class="fr" @click="">同步商品</el-button>
                </div>
                <div>
                    库存预警设置：
                    <el-input v-model="warning.start_num" placeholder="" class="li_input"></el-input>
                    至
                    <el-input v-model="warning.end_num" placeholder="" class="li_input"></el-input>
                    <i class="blue_c">修改</i>
                </div>
                <div class="basic_inf">
                    <el-table
                            :data="list.filter(data => !input || data.name.toLowerCase().includes(input.toLowerCase()))"
                            style="width: 100%">
                        <el-table-column
                                prop="type"
                                label="品项"
                                :formatter="formatter">
                        </el-table-column>
                        <el-table-column
                                prop="name"
                                label="名称">
                        </el-table-column>
                        <el-table-column
                                prop="stock"
                                label="实时库存">
                        </el-table-column>
                        <el-table-column
                                prop="beforehand_num"
                                label="已预售">
                        </el-table-column>
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <el-button type="success" size="mini" @click="now=scope.row;in_ware=true">入库</el-button>
                                <el-button type="danger" size="mini" @click="now=scope.row;out_ware=true">出库</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </el-tab-pane>

            <el-tab-pane label="出库流水记录">
                <div class="cus_center">
                    <el-input class="cus_seatch"
                              placeholder="请输入商品名称/操作人"
                              v-model="input2">
                        <i slot="prefix" class="el-input__icon el-icon-search"></i>
                    </el-input>
                    <el-date-picker class="cus_seatch"
                                    v-model="value"
                                    type="date"
                                    placeholder="选择日期">
                    </el-date-picker>
                </div>
                <div class="basic_inf">
                    <el-table
                            :data="myOut.filter(data => !input2 || data.name.toLowerCase().includes(input2.toLowerCase()) ||
                            data.operation_human.toLowerCase().includes(input2.toLowerCase()))"
                            style="width: 100%">
                        <el-table-column
                                prop="time"
                                label="出库时间">
                        </el-table-column>
                        <el-table-column
                                prop="name"
                                label="名称">
                        </el-table-column>
                        <!--<el-table-column
                                prop="handle"
                                label="手动出库">
                        </el-table-column>-->
                        <el-table-column
                                prop="sum"
                                label="出库数量">
                        </el-table-column>
                        <el-table-column
                                prop="operation_human"
                                label="操作人">
                        </el-table-column>
                    </el-table>
                </div>
            </el-tab-pane>

            <el-tab-pane label="入库流水记录">
                <div class="cus_center">
                    <el-input class="cus_seatch"
                              placeholder="请输入商品名称/操作人"
                              v-model="input2">
                        <i slot="prefix" class="el-input__icon el-icon-search"></i>
                    </el-input>
                    <el-date-picker class="cus_seatch"
                                    v-model="value"
                                    type="date"
                                    placeholder="选择日期">
                    </el-date-picker>
                </div>
                <div class="basic_inf">
                    <el-table
                            :data="myIn.filter(data => !input2 || data.name.toLowerCase().includes(input2.toLowerCase()) ||
                            data.operation_human.toLowerCase().includes(input2.toLowerCase()))"
                            style="width: 100%">
                        <el-table-column
                                prop="time"
                                label="入库时间">
                        </el-table-column>
                        <el-table-column
                                prop="name"
                                label="名称">
                        </el-table-column>
                        <el-table-column
                                prop="sum"
                                label="入库数量">
                        </el-table-column>
                        <el-table-column
                                prop="operation_human"
                                label="操作人">
                        </el-table-column>
                    </el-table>
                </div>
            </el-tab-pane>
        </el-tabs>
        <!--商品入库-->
        <el-dialog title="商品入库"
                   :visible.sync="in_ware"
                   width="460px"
                   center
                   :before-close="close">
            <ul class="goods_edit">
                <li>
                    <span class="list_left">品项</span>
                    <span class="list_right">
                        {{now.type==1?'产品':now.type==2?'套盒':'耗材'}}
                    </span>
                </li>
                <li>
                    <span class="list_left">商品名称</span>
                    <span class="list_right">
                    {{now.name}}
                </span>
                </li>
                <li>
                    <span class="list_left">现有库存</span>
                    <span class="list_right">
                        {{now.stock}}
                    </span>
                </li>
                <li>
                    <span class="list_left">入库数量</span>
                    <span class="list_right">
                        <el-input type="number" placeholder="请输入入库数量" v-model="data.sum"></el-input>
                    </span>
                </li>
                <li>
                    <span class="list_left">进价</span>
                    <span class="list_right">
                    <el-input type="number" placeholder="请输入商品进价" v-model="data.price"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">总成本</span>
                    <span class="list_right">
                    {{data.price * data.sum}}
                </span>
                </li>
                <li>
                    <span class="list_left">入库人</span>
                    <span class="list_right">
                    <el-input placeholder="请填写入库操作人" v-model="data.human"></el-input>
                </span>
                </li>
            </ul>
            <span slot="footer" class="dialog-footer">
            <el-button @click="close">取 消</el-button>
            <el-button type="primary" @click="into()">确 定</el-button>
          </span>
        </el-dialog>
        <!--商品出库-->
        <el-dialog title="商品出库"
                   :visible.sync="out_ware"
                   width="460px"
                   center
                   :before-close="close">
            <ul class="goods_edit">
                <li>
                    <span class="list_left">品项</span>
                    <span class="list_right">
                        {{now.type==1?'产品':now.type==2?'套盒':'耗材'}}
                    </span>
                </li>
                <li>
                    <span class="list_left">商品名称</span>
                    <span class="list_right">
                    {{now.name}}
                </span>
                </li>
                <li>
                    <span class="list_left">现有库存</span>
                    <span class="list_right">
                        {{now.stock}}
                    </span>
                </li>
                <li>
                    <span class="list_left">出库数量</span>
                    <span class="list_right">
                        <el-input v-model="data.sum" placeholder="请输入入库数量"></el-input>
                    </span>
                </li>
                <li>
                    <span class="list_left">出库人</span>
                    <span class="list_right">
                    <el-input placeholder="请填写出库操作人" v-model="data.human"></el-input>
                </span>
                </li>
            </ul>
            <span slot="footer" class="dialog-footer">
            <el-button @click="close">取 消</el-button>
            <el-button type="primary" @click="into('out')">确 定</el-button>
          </span>
        </el-dialog>
    </template>
</div>

</body>
</html>
<script src="../js/jquery.min.js"></script>
<script src="../js/vue.js"></script>
<script src="../js/func.js"></script>
<script src="../js/index.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            checkList: '',
            dialogVisible: false,
            in_ware: false,
            out_ware: false,
            input: '',
            radio: '',
            table_data: [{
                px: '产品',
                name: '补水面膜',
                stock: '15',
                pre: '0'
            }, {
                px: '套盒',
                name: '肩颈套',
                stock: '0',
                pre: '3'
            }],
            out_data: [{
                out_time: '2018-02-15',
                name: '肩颈套',
                handle: '手动出库',
                num: '3',
                do_per: '丽丽'
            }, {
                out_time: '2018-02-15',
                name: '肩颈套',
                handle: '手动出库',
                num: '3',
                do_per: '丽丽'
            }],
            options: [{
                value: '2',
                label: '男'
            }, {
                value: '1',
                label: '女'
            }],
            calss: [{
                value: 2,
                label: '农历'
            }, {
                value: 1,
                label: '阳历'
            }],
            status: [{
                value: 1,
                label: '已婚'
            }, {
                value: 2,
                label: '未婚'
            }],
            value: '',
            birth: '',

            id: 0,
            list: [],
            warning: {},
            data: {
                sum: '',
                price: '',
                human: '',
            },
            now: {},
            myIn: [],
            myOut: [],
            input2: '',
        },
        methods: {
            getRecord(day='') {
                this.myIn = []
                this.myOut = []
                $.post(url(methods.getRecordDetail), {day: day, ware: this.id}, v=>{
                    for(let x of v['res']) {
                        if(x['status'] == 1){
                            this.myIn.push(x)
                        }else{
                            this.myOut.push(x)
                        }
                    }
                })
            },
            close() {
                this.in_ware = false
                this.out_ware = false
                this.now = {}
                this.data = {
                    sum: '',
                    price: '',
                    human: '',
                }
            },
            into(type = 'into') {
                if (type == 'into') {
                    if (this.data.sum == '' || this.data.price == '' || this.data.human == '') {
                        return error('请填完以上内容')
                    }
                } else {
                    if (this.data.sum == '' || this.data.human == '') {
                        return error('请填完以上内容')
                    }
                }

                this.data.goods_type = this.now.type;
                $.post(url(methods.stockOperation), {
                    id: this.now.id, type: type, ware: this.id, data: type == 'into' ? this.data:{
                        sum: this.data.sum,
                        human: this.data.human,
                        goods_type: this.data.goods_type,
                    }
                }, v => {
                    if (v['code'] == 1) {
                        success(v['Msg'])
                        this.close()
                        this.getData()
                    } else {
                        error('失败')
                    }
                })
            },
            formatter(r, c) {
                if (r.type == 1) {
                    return '产品'
                }
                if (r.type == 2) {
                    return '套盒'
                }
                if (r.type == 3) {
                    return '耗材'
                }
            },
            getData() {
                $.post(url(methods.wareIntoOutDetail), {ware: this.id}, v => {
                    this.warning = v['res']['warning']
                    this.list = v['res']['res']
                })
            },
            myClick(v, v2) {
                if(v.index==0){
                    this.getData()
                }else{
                    this.getRecord()
                }
                this.input2 = ''
            }
        },
        mounted() {
            this.$nextTick(e => {
                //初始化
                that = this;
                loginState()
                this.id = localStorage.getItem('wareId')
                this.getData()
            })
        }
    })
</script>