<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会员档案</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link rel="stylesheet" type="text/css" href="../css/vip_information.css">
    <link rel="stylesheet" type="text/css" href="../css/add_archives.css">
</head>
<body class="information">

<div id="app" class="customer">
    <template>
        <p class="cus_title">
            <el-breadcrumb separator-class="el-icon-arrow-right">
                <el-breadcrumb-item><a href="home.html" target="iframe">工作台首页</a></el-breadcrumb-item>
                <el-breadcrumb-item><a href="customer.html" target="iframe">会员管理</a></el-breadcrumb-item>
                <el-breadcrumb-item>会员档案</el-breadcrumb-item>
            </el-breadcrumb>
        </p>
        <el-tabs type="card" @tab-click="handleClick"
                 class="vip_infor" v-if="userInfo != null">
            <el-tab-pane label="基本资料">
                <div class="basic_inf">
                    <ul class="basic_ul">
                        <li>
                            <p>
                                姓名：
                                <el-input v-model="userInfo.name" placeholder="请输入"
                                          class="infor_wid un_line_h"></el-input>
                            </p>
                            <p>
                                性别：
                                <el-select v-model="userInfo.sex" placeholder="请选择" class="sele_wid">
                                    <el-option
                                            v-for="item in options"
                                            :label="item.label"
                                            :value="item.value">
                                    </el-option>
                                </el-select>
                            </p>
                            <p>会员编号：
                                <el-input v-model="userInfo.shop_num" placeholder="请输入"
                                          class="infor_wid un_line_h"></el-input>
                            </p>
                        </li>
                        <li>
                            <p>
                                手机：
                                <el-input v-model="userInfo.tel" placeholder="请输入" maxlength="11"
                                          class="infor_wid un_line_h"></el-input>
                            </p>
                            <p>
                                生日：
                                <el-select v-model="userInfo.bir_type" placeholder="请选择" class="sele_wid">
                                    <el-option
                                            v-for="item in calss"
                                            :key="item.value"
                                            :label="item.label"
                                            :value="item.value">
                                    </el-option>
                                </el-select>
                                <el-date-picker
                                        v-model="userInfo.yl"
                                        type="date"
                                        value-format="yyyy-MM-dd"
                                        placeholder="选择日期" class="time_wid">
                                </el-date-picker>
                            </p>
                            <p>
                                入会时间：
                                <el-date-picker
                                        disabled
                                        v-model="userInfo.create_time"
                                        type="date"
                                        placeholder="选择日期" class="time_wid">
                                </el-date-picker>
                            </p>
                        </li>
                        <li>
                            <p>
                                地址：
                                <el-input v-model="userInfo.address" placeholder="请输入"
                                          class="infor_wid un_line_h"></el-input>
                            </p>
                            <p>
                                婚姻状况：
                                <el-select v-model="userInfo.marital" placeholder="请选择" class="sele_wid">
                                    <el-option
                                            v-for="item in status"
                                            :key="item.value"
                                            :label="item.label"
                                            :value="item.value">
                                    </el-option>
                                </el-select>
                            </p>
                            <p>
                                积分：
                                <el-button @click="integral_dio=true;getIntegral()" type="warning">{{userInfo.integral}}</el-button>
                                <!--<el-input v-model="userInfo.integral" placeholder="" type="number"-->
                                          <!--class="infor_wid un_line_h"></el-input>-->
                            </p>
                        </li>
                        <li>
                            <p>
                                账户余额：
                                <el-input v-model="userInfo.balance" placeholder="请输入会员余额" type="number"
                                          class="infor_wid un_line_h"></el-input>
                            </p>
                            <p>
                                赠送余额：
                                <el-input v-model="userInfo.send_balance" placeholder="请输入会员余额" type="number"
                                          class="infor_wid un_line_h"></el-input>
                            </p>
                            <p></p>
                        </li>
                        <li>
                            <p>
                                客户需求：
                                <el-button type="primary" @click="add_demand_dio=true" size="mini" plain class="fr mar_bottom">添加客户需求</el-button>
                            </p>
                        </li>
                        <li v-if="demand_list!=''">
                            <ul>
                                <li v-for="v in demand_list">
                                    {{v['createtime']}}：<span v-for="x in v.need" class="need_span">{{x}}</span>
                                    <el-button type="danger" @click="del_demand(v.id)" size="mini" plain class="fr mar_bottom">删除</el-button>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <div class="bottom_but">
                        <el-button type="success" @click="modifyUser">修改</el-button>
                    </div>
                </div>
            </el-tab-pane>
            <el-tab-pane label="会员产品">
                <div class="basic_inf">
                    <el-button type="success" class="fr" @click="del(1)"
                               style="margin:5px 10px;">批量删除
                    </el-button>
                    <el-table
                            :data="cpList"
                            style="width: 100%"
                            @selection-change="handle">
                        <el-table-column
                                type="selection"
                                width="60">
                        </el-table-column>
                        <el-table-column
                                prop="goods_name"
                                label="产品名称">
                        </el-table-column>
                        <el-table-column
                                prop="price"
                                label="价格">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                prop="sum"
                                label="数量">
                        </el-table-column>
                        <!--<el-table-column
                                prop="dis_price"
                                label="折后金额">-->
                        </el-table-column>
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <el-button type="danger" size="mini" @click="del(1, scope.row, 2)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div class="total">
                      <span class="fl">
                      <p class="cr">汇总：</p>
                    <p class="money_total">累计购买金额：{{total}}</p>
                    <p class="money_total">欠款：{{arrears}}</p>
                  </span>
                        <el-button type="success" class="go_buy fr" @click="jump">购买产品</el-button>
                    </div>
                </div>
            </el-tab-pane>
            <el-tab-pane label="会员项目">
                <div class="basic_inf">
                    <el-button type="success" class="fr" @click="del(2)" style="margin:5px 10px;">批量删除</el-button>
                    <el-table
                            :data="itemsList"
                            style="width: 100%"
                            @selection-change="handle2">
                        <el-table-column
                                type="selection"
                                width="60">
                        </el-table-column>
                        <el-table-column
                                prop="name"
                                label="项目名称">
                        </el-table-column>
                        <el-table-column
                                prop="price"
                                label="价格">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                prop="current_num"
                                label="剩余次数">
                        </el-table-column>
                        <el-table-column
                                prop="originally_num"
                                label="总次数">
                        </el-table-column>
                        <!--<el-table-column
                                prop="dis_price"
                                label="折后金额">
                        </el-table-column>-->
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <!--<el-button type="warning" size="mini" @click="edit_m_own_dio=true">编辑</el-button>-->
                                <el-button type="danger" size="mini" @click="del(2, scope.row, 2)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div class="total">
                    <span class="fl">
                          <p class="cr">汇总：</p>
                        <p class="money_total">剩余次数：{{num}}</p>
                        <!--<p class="money_total">欠款：{{arrears2}}</p>-->
                    </span>
                        <el-button type="success" class="go_buy fr" @click="jump">购买项目</el-button>
                    </div>
                </div>
            </el-tab-pane>
            <el-tab-pane label="会员方案" :key="90">
                <div class="basic_inf">
                    <el-button type="success" class="fr" @click="del(2)" style="margin:5px 10px;">批量删除</el-button>
                    <el-table
                            :data="planList"
                            style="width: 100%"
                            @selection-change="handle2">
                        <el-table-column
                                type="selection"
                                width="60">
                        </el-table-column>
                       <!-- <el-table-column
                                prop="plan_name"
                                label="方案名称">
                        </el-table-column>-->
                        <el-table-column
                                prop="name"
                                label="商品名称">
                        </el-table-column>
                        <el-table-column
                                prop="price"
                                label="价格">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                prop="current_num"
                                label="剩余次数">
                        </el-table-column>
                        <el-table-column
                                prop="originally_num"
                                label="总次数">
                        </el-table-column>
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <!--<el-button type="warning" size="mini" @click="console(scope.row);own_data=scope.row;edit_type='plan'">编辑</el-button>-->
                                <el-button type="danger" size="mini" @click="del(2, scope.row, 2)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div class="total">
                    <span class="fl">
                          <p class="cr">汇总：</p>
                        <p class="money_total">剩余次数：{{num3}}</p>
                        <!--<p class="money_total">欠款：{{arrears4}}</p>-->
                    </span>
                        <el-button type="success" class="go_buy fr" @click="jump">购买方案</el-button>
                    </div>
                </div>
            </el-tab-pane>
            <el-tab-pane label="会员套盒">
                <div class="basic_inf">
                    <el-button type="success" class="fr" @click="del(3)" style="margin:5px 10px;">批量删除</el-button>
                    <el-table
                            :data="boxList"
                            style="width: 100%"
                            @selection-change="handle3">
                        <el-table-column
                                type="selection"
                                width="60">
                        </el-table-column>
                        <el-table-column
                                prop="name"
                                label="套盒名称">
                        </el-table-column>
                        <el-table-column
                                prop="price"
                                label="价格">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                prop="current_num"
                                label="剩余次数">
                        </el-table-column>
                        <el-table-column
                                prop="originally_num"
                                label="总次数">
                        </el-table-column>
                        <!--<el-table-column
                                prop="dis_price"
                                label="折后金额">
                        </el-table-column>-->
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <!--<el-button type="warning" size="mini" @click="console(scope.row);own_data=scope.row;edit_type='box'">编辑</el-button>-->
                                <el-button type="danger" size="mini" @click="del(3, scope.row, 2)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div class="total">
                      <span class="fl">
                      <p class="cr">汇总：</p>
                    <p class="money_total">剩余次数：{{num2}}</p>
                    <!--<p class="money_total">欠款：{{arrears3}}</p>-->
                  </span>
                        <el-button type="success" class="go_buy fr" @click="jump">购买套盒</el-button>
                    </div>
                </div>
            </el-tab-pane>

            <el-tab-pane label="优惠券查看">
                <div class="cus_center">
                    <el-button type="success" class="fr" @click="get_coupon_Dio = true;get_all_cou()">赠送优惠券</el-button>
                </div>
                <div class="basic_inf">
                    <el-table
                            :data="coupon"
                            style="width: 100%">
                        <el-table-column
                                prop="coupon_name"
                                label="优惠券名称">
                        </el-table-column>
                        <el-table-column
                                label="优惠券类型">
                            <template slot-scope="scope">
                                <i v-if="scope.row.coupon_type=='满减'">满减</i>
                                <i v-if="scope.row.coupon_type=='抵扣'">抵扣</i>
                                <i v-if="scope.row.coupon_type==1">满减</i>
                                <i v-if="scope.row.coupon_type==2">满折</i>
                                <i v-if="scope.row.coupon_type==3">满赠</i>
                                <i v-if="scope.row.coupon_type==4">抵扣</i>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="优惠券属性">
                            <template slot-scope="scope">
                                <i v-if="scope.row.coupon_type=='满减'"> 满{{scope.row.enough}}减{{scope.row.dedut}}</i>
                                <i v-if="scope.row.coupon_type=='抵扣'"> 满{{scope.row.dedut}}可用</i>
                                <i v-if="scope.row.coupon_type==1"> 满{{scope.row.enough}}减{{scope.row.dedut}}</i>
                                <i v-if="scope.row.coupon_type==2"> 满{{scope.row.enough}}减{{scope.row.send}}</i>
                                <i v-if="scope.row.coupon_type==3"> 满{{scope.row.enough}}减{{scope.row.discount}}</i>
                                <i v-if="scope.row.coupon_type==4"> 满{{scope.row.dedut}}可用</i>
                            </template>
                        </el-table-column>

                    </el-table>
                </div>
            </el-tab-pane>
            <el-tab-pane label="所持卡项">
                <div class="basic_inf">
                    <el-table
                            :data="card"
                            style="width: 100%">
                        <el-table-column
                                :formatter="formatter"
                                label="类型">
                        </el-table-column>
                        <el-table-column
                                prop="name"
                                label="名称">
                        </el-table-column>
                        <el-table-column
                                prop="amount"
                                label="余额">
                        </el-table-column>
                        <el-table-column min-width="150"
                                label="折扣">
                            <template slot-scope="scope">
                                <i v-if="scope.row.card_type==1">无</i>
                                <i v-if="scope.row.card_type==2">
                                    产品:{{scope.row.product}}折&#12288;套盒:{{scope.row.suitbox}}折&#12288;项目:{{scope.row.items}}折&#12288;礼包:{{scope.row.gift}}折
                                </i>
                                <i v-if="scope.row.card_type==3">
                                    {{scope.row.discount}}折
                                </i>
                            </template>
                        </el-table-column>
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <!--<el-button type="warning" size="mini" @click="card_eDio=true;card_data=scope.row">编辑</el-button>-->
                                <el-button type="danger" size="mini" @click="card_del(scope.row.id)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </el-tab-pane>
            <!--<el-tab-pane label="积分">
                <div class="basic_inf">

                    &lt;!&ndash;<div class="total">
                    <span class="fl">
                          <p class="cr">汇总：</p>
                        <p class="money_total">累计积分：23565分</p>
                        <p class="money_total">可用积分：562分</p>
                    </span>
                        <el-button type="success" class="go_buy fr">新增记录</el-button>
                    </div>&ndash;&gt;
                </div>
            </el-tab-pane>-->
            <el-tab-pane label="欠款">
                <div class="basic_inf">
                    <el-table
                            :data="arrearsList"
                            style="width: 100%">
                        <el-table-column
                                prop="time"
                                label="购买日期">
                        </el-table-column>
                        <el-table-column
                                prop="buy_name"
                                label="消费商品">
                        </el-table-column>
                        <!--<el-table-column
                                prop="time"
                                label="摘要">
                        </el-table-column>-->
                        <el-table-column
                                prop="money"
                                label="欠款金额">
                        </el-table-column>
                        <!--<el-table-column
                                prop="time"
                                label="经手人">
                        </el-table-column>-->
                        <el-table-column label="操作">
                            <template slot-scope="scope">
                                <a href="#" class="cr" @click="bk(scope.row.id)">补款</a>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div class="total">
                    <span class="fl">
                          <p class="cr">汇总：</p>
                        <p class="money_total">欠款合计：{{totalArrears}}元</p>
                    </span>
                    </div>
                </div>
            </el-tab-pane>
            <el-tab-pane label="健康档案">
                <div class="cus_center over_hidden">
                    <el-button type="success" class="fr" @click="add_hel"
                               style="margin-bottom: 5px">新增档案
                    </el-button>
                </div>
                <ul class="ul_list">
                    <li v-for="v in list">
                        {{v.create_time}}
                        <el-button class="fr" @click="getJK(v.id)">查看</el-button>
                        <el-button class="fr" @click="getJK2(v.id)" style="margin-right: 10px">编辑</el-button>
                        <el-button type="danger" class="fr" @click="delJK(v.id)">删除</el-button>
                    </li>
                </ul>
            </el-tab-pane>
            <el-tab-pane label="消费明细">
                <div class="cus_center">
                    <el-radio-group v-model="nowPos" class="store_tabs">
                        <el-radio-button label="项目"></el-radio-button>
                        <el-radio-button label="产品"></el-radio-button>
                        <el-radio-button label="套盒"></el-radio-button>
                        <el-radio-button label="充值"></el-radio-button>
                        <el-radio-button label="方案"></el-radio-button>
                        <el-radio-button label="内衣"></el-radio-button>
                    </el-radio-group>
                </div>
                <div class="basic_inf">
                    <el-table v-show="nowPos=='项目'"
                              :data="xf_xm"
                              style="width: 100%">
                        <el-table-column
                                prop="name"
                                label="项目名称">
                        </el-table-column>
                        <el-table-column
                                label="方式">
                            <template slot-scope="scope">
                                <i v-if="scope.row.status == 1">消费-(买入)</i>
                                <i v-if="scope.row.status == 2">消耗-(使用)</i>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="money"
                                label="金额">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                label="支付明细">
                            <template slot-scope="scope">
                                <el-button type="primary" @click="pay_data=scope.row;pay_dio=true" plain size="mini">查看</el-button>
                            </template>
                        </el-table-column>

                    </el-table>
                    <el-table v-show="nowPos=='产品'"
                              :data="xf_cp"
                              style="width: 100%">
                        <el-table-column
                                prop="name"
                                label="产品名称">
                        </el-table-column>
                        <el-table-column
                                prop="money"
                                label="消费金额">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                label="支付明细">
                            <template slot-scope="scope">
                                <el-button type="primary" @click="pay_data=scope.row;pay_dio=true" plain size="mini">查看</el-button>
                            </template>
                        </el-table-column>

                    </el-table>
                    <el-table v-show="nowPos=='套盒'"
                              :data="xf_th"
                              style="width: 100%">
                        <el-table-column
                                prop="name"
                                label="套盒名称">
                        </el-table-column>
                        <el-table-column
                                label="方式">
                            <template slot-scope="scope">
                                <i v-if="scope.row.status == 1">消费-(买入)</i>
                                <i v-if="scope.row.status == 2">消耗-(使用)</i>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="money"
                                label="金额">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                label="支付明细">
                            <template slot-scope="scope">
                                <el-button type="primary" @click="pay_data=scope.row;pay_dio=true" plain size="mini">查看</el-button>
                            </template>
                        </el-table-column>

                    </el-table>
                    <el-table v-show="nowPos=='充值'"
                              :data="xf_cz"
                              style="width: 100%">
                        <el-table-column
                                prop="name"
                                label="卡项名称">
                        </el-table-column>
                        <el-table-column
                                label="方式">
                            <template slot-scope="scope">
                                <i v-if="scope.row.status == 1">消费-(买入)</i>
                                <i v-if="scope.row.status == 2">消耗-(使用)</i>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="money"
                                label="消费/消耗金额">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                    </el-table>
                    <el-table v-show="nowPos=='方案'"
                              :data="xf_fa"
                              style="width: 100%">
                        <el-table-column
                                prop="name"
                                label="项目名称">
                        </el-table-column>
                        <el-table-column
                                label="方式">
                            <template slot-scope="scope">
                                <i v-if="scope.row.status == 1">消费-(买入)</i>
                                <i v-if="scope.row.status == 2">消耗-(使用)</i>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="money"
                                label="金额">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                label="支付明细">
                            <template slot-scope="scope">
                                <el-button type="primary" @click="pay_data=scope.row;pay_dio=true" plain size="mini">查看</el-button>
                            </template>
                        </el-table-column>

                    </el-table>
                    <el-table v-show="nowPos=='内衣'"
                              :data="xf_ny"
                              style="width: 100%">
                        <el-table-column
                                prop="name"
                                label="内衣名称">
                        </el-table-column>
                        <el-table-column
                                prop="money"
                                label="消费金额">
                        </el-table-column>
                        <el-table-column
                                prop="time"
                                label="时间">
                        </el-table-column>
                        <el-table-column
                                label="支付明细">
                            <template slot-scope="scope">
                                <el-button type="primary" @click="pay_data=scope.row;pay_dio=true" plain size="mini">查看</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </el-tab-pane>
        </el-tabs>
        <el-dialog v-if="detail!=''"
                   title="查看档案"
                   :visible.sync="dialogVisible"
                   width="50%" center>
            <ul class="record_list">
                <li>
                    <p>需要解决的皮肤问题：
                        <span v-for="v in detail.face_detail">{{v.title}}: {{v.content}}</span>
                    </p>
                    <!--<div>没有需要解决的问题喔~</div>-->
                </li>

                <li>
                    <p>需要解决的身体问题：
                        <span v-for="v in detail.body_detail">{{v.title}}: {{v.content}}</span>
                    </p>
                </li>

                <li>
                    过敏史：{{detail.res.allergy}}

                </li>

                <li>
                    面部解决方案：{{detail.res.face}}

                </li>

                <li>
                    身体解决方案：
                    {{detail.res.body}}
                </li>

                <li>
                    单次操作项目及手法：
                    {{detail.res.one_opera}}
                </li>
                <li>
                    <i>品项设计：</i>
                    <div class="choice_list">
                        <i>
                            <span class="product_red_color color_box" v-for="v in detail.res.design">{{v.name}}</span>
                            <!--<span class="project_green_color color_box">项目</span>
                            <span class="taohe_color color_box">套盒</span>
                            <span class="plan_color color_box">方案</span>-->
                        </i>
                    </div>
                </li>

                <li class="disflex">
                    下次预约时间：{{detail.res.next_time}}
                </li>

                <li>
                    <span>顾问：{{detail.res.gw}}</span>
                </li>

                <li>
                    备注：{{detail.res.remarks}}
                </li>
            </ul>

        </el-dialog>
        <!--编辑档案-->
        <el-dialog v-if="detail2!=''"
                   title="编辑档案"
                   :visible.sync="dialogVisible2"
                   width="50%" center>
            <ul class="record_list">
                <li>
                    <p>需要解决的皮肤问题：
                        <span v-for="v in detail2.face_detail">{{v.title}}: {{v.content}}</span>
                    </p>
                    <!--<div>没有需要解决的问题喔~</div>-->
                </li>

                <li>
                    <p>需要解决的身体问题：
                        <span v-for="v in detail2.body_detail">{{v.title}}: {{v.content}}</span>
                    </p>
                </li>

                <li>
                    <el-input placeholder="请输入内容" v-model="detail2.res.allergy">
                        <template slot="prepend">过敏史：</template>
                    </el-input>
                </li>

                <li>
                    <el-input placeholder="请输入内容" v-model="detail2.res.face">
                        <template slot="prepend">面部解决方案：</template>
                    </el-input>
                </li>

                <li>
                    <el-input placeholder="请输入内容" v-model="detail2.res.body">
                        <template slot="prepend">身体解决方案：</template>
                    </el-input>
                </li>

                <li>
                    <el-input placeholder="请输入内容" v-model="detail2.res.one_opera">
                        <template slot="prepend">单次操作项目及手法：</template>
                    </el-input>
                </li>
                <li>
                    <i>品项设计：</i>
                    <div class="choice_list">
                        <i>
                            <span class="product_red_color color_box" v-for="v in detail2.res.design">{{v.name}}</span>
                            <!--<span class="project_green_color color_box">项目</span>
                            <span class="taohe_color color_box">套盒</span>
                            <span class="plan_color color_box">方案</span>-->
                        </i>
                    </div>
                </li>

                <li class="disflex">
                    下次预约时间：
                    <el-date-picker
                            v-model="detail2.res.next_time"
                            type="datetime"
                            value-format="yyyy-MM-dd HH:mm"
                            placeholder="选择日期时间">
                    </el-date-picker>
                </li>

                <li>
                    <el-input placeholder="请输入内容" v-model="detail2.res.gw" disabled>
                        <template slot="prepend">顾问：</template>
                    </el-input>
                </li>

                <li>
                    <el-input placeholder="请输入内容" v-model="detail2.res.remarks">
                        <template slot="prepend">备注：</template>
                    </el-input>
                </li>
            </ul>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible2 = false">取 消</el-button>
                <el-button type="primary" @click="modify()">确 定</el-button>
              </span>
        </el-dialog>
        <!-- 需求添加 -->
        <el-dialog
                title="客户需求添加"
                :visible.sync="add_demand_dio"
                center>
            <ul class="goods_edit">
                <li>
                    <span class="list_left">需求添加</span>
                    <span class="list_right">
                    <el-input v-model="text" style="width: 60%" placeholder="请输入客户需求"></el-input>
                        <el-button type="warning" @click="add_demand">添加</el-button>
                </span>
                </li>
            </ul>
            <div class="add_list " v-if="add_list.length>0">
					<span class="need_span" v-for="(v, i) in add_list">{{v}}
						<i class="el-icon-error need_dele_icon" @click="remove(i)"></i>
					</span>
            </div>
            <span slot="footer" class="dialog-footer">
            <el-button @click="need_close">取 消</el-button>
            <el-button type="primary" @click="sub">确 定</el-button>
          </span>
        </el-dialog>
        <!--支付明细-->
        <el-dialog
                title="支付明细"
                :visible.sync="pay_dio"
                center>
            <ul class="pay_ul">
                <li>
                    卡扣支付：{{pay_data.card_pay}}
                </li>
                <li>
                    余额支付：{{pay_data.account_pay}}
                </li>
                <li>
                    现金支付：{{pay_data.cash_pay}}
                </li>
                <li>
                    微信支付：{{pay_data.wx_pay}}
                </li>
                <li>
                    支付宝支付：{{pay_data.zfb_pay}}
                </li>
                <li>
                    银行卡支付：{{pay_data.bank}}
                </li>
                <li>
                    美团支付：{{pay_data.mt}}
                </li>
                <li>
                    大众点评支付：{{pay_data.dzdp}}
                </li>
                <li>
                    收钱吧支付：{{pay_data.sqb}}
                </li>
                <li>
                    优惠券支付：{{pay_data.counpon}}
                </li>
                <li>
                    合计消费：{{pay_data.money}}
                </li>
            </ul>
        </el-dialog>
        <!-- 赠送优惠券 -->
        <el-dialog
                title="赠送优惠券"
                :visible.sync="get_coupon_Dio"
                width="300"
                center>
            <div style="text-align: center">
                <el-select v-model="send_id" placeholder="请选择">
                    <el-option
                            v-for="item in con_list"
                            :label="item.coupon_name"
                            :value="item.id">
                    </el-option>
                </el-select>
            </div>
            <span slot="footer" class="dialog-footer">
            <el-button @click="get_coupon_Dio = false">取 消</el-button>
            <el-button type="primary" @click="send_cou">确 定</el-button>
          </span>
        </el-dialog>
        <!-- 积分记录 -->
        <el-dialog
                title="积分记录"
                :visible.sync="integral_dio"
                center>
            <el-table
                    :data="integer"
                    style="width: 100%">
                <el-table-column
                        prop="time"
                        label="日期">
                </el-table-column>
                <el-table-column
                        label="状态">
                    <template slot-scope="scope">
                        <i ng-if="scope.row.status == 1">赠送</i>
                        <i ng-if="scope.row.status == 2">使用</i>
                    </template>
                </el-table-column>
                <el-table-column
                        prop="integral"
                        label="积分">
                </el-table-column>
                <!--<el-table-column
                        prop="status"
                        label="消费商品">
                </el-table-column>
                <el-table-column
                        prop="time"
                        label="划扣积分">
                </el-table-column>
                <el-table-column
                        prop="time"
                        label="存入积分">
                </el-table-column>
                <el-table-column
                        prop="time"
                        label="经手人">
                </el-table-column>-->
                <!--<el-table-column label="操作">
                    <template slot-scope="scope">
                        <a href="#" class="cr">删除</a>
                    </template>
                </el-table-column>-->
            </el-table>
        </el-dialog>
        <!--会员持有的编辑-->
        <el-dialog
                title="会员商品编辑"
                :visible.sync="edit_m_own_dio"
                center>
            <ul class="goods_edit">
                <li>
                    <span class="list_left">商品名称</span>
                    <span class="list_right">
                    <el-input v-model="own_data.name" placeholder="请输入商品名称"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">购价</span>
                    <span class="list_right">
                    <el-input v-model="own_data.price" placeholder="请输入商品购价"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">原本次数</span>
                    <span class="list_right">
                    <el-input v-model="own_data.originally_num" placeholder="请输入原本次数" type="number"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">剩余次数</span>
                    <span class="list_right">
                    <el-input v-model="own_data.current_num" placeholder="请输入原本次数" type="number"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">手工</span>
                    <span class="list_right">
                    <el-input v-model="own_data.fee" placeholder="请输入手工" type="number"></el-input>
                </span>
                </li>
            </ul>
            <span slot="footer" class="dialog-footer">
            <el-button @click="edit_m_own_dio=false">取 消</el-button>
            <el-button type="primary" @click="edit_v_own(own_data.id)">确 定</el-button>
          </span>
        </el-dialog>
        <!--会员卡项的编辑-->
        <el-dialog
                title="会员持有卡项编辑"
                :visible.sync="card_eDio"
                center
                :before-close="own_cancel()">
            <ul class="goods_edit">
                <li>
                    <span class="list_left">卡项名称</span>
                    <span class="list_right">
                    <el-input v-model="own_data.name" placeholder="请输入商品名称"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">卡名</span>
                    <span class="list_right">
                    <el-input v-model="card_data.card_name" placeholder="请输入卡名"></el-input>
                </span>
                </li>
                <li>
                    <span class="list_left">卡内余额</span>
                    <span class="list_right">
                    <el-input v-model="card_data.amount" type="number" placeholder="请输入卡内余额"></el-input>
                </span>
                </li>
                <li v-if="card_data.card_type==3">
                    <span class="list_left">折扣</span>
                    <span class="list_right">
                    <el-input v-model="card_data.discount" type="number" placeholder="请输入折扣" @blur="check_bulk(detail.discount)"></el-input>
                </span>
                </li>
                <li v-if="card_data.card_type==2" class="dis_div">
                    <span>
                        套盒折扣：&#12288;
                        <el-input v-model="card_data.suitbox" type="number" placeholder="0" class="in_wid" @blur="check_bulk(card_data.suitbox)"></el-input>&nbsp;%
                    </span>
                    <span>
                        产品折扣：&#12288;
                        <el-input v-model="card_data.product" type="number" placeholder="0" class="in_wid" @blur="check_bulk(card_data.product)"></el-input>&nbsp;%
                    </span>
                    <span>
                        礼包折扣：&#12288;
                        <el-input v-model="card_data.gift" type="number" placeholder="0" class="in_wid" @blur="check_bulk(card_data.gift)"></el-input>&nbsp;%
                    </span>
                    <span>
                        项目折扣：&#12288;
                        <el-input v-model="card_data.items" type="number" placeholder="0" class="in_wid" @blur="check_bulk(card_data.items)"></el-input>&nbsp;%
                    </span>
                </li>
            </ul>
             <span slot="footer" class="dialog-footer">
             <el-button @click="own_cancel">取 消</el-button>
             <el-button type="primary" @click="card_edit(card_data.id)">确 定</el-button>
           </span>
        </el-dialog>
    </template>
</div>

</body>
</html>
<script src="../js/jquery.min.js"></script>
<script src="../js/vue.js"></script>
<script src="../js/func.js"></script>
<script src="../js/index.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            send_id:'',
            con_list:'',
            demand_list:'',
            checkList: '',
            get_coupon_Dio: false,
            dialogVisible: false,
            dialogVisible2: false,
            add_demand_dio:false,
            integral_dio:false,
            edit_m_own_dio:false,
            card_eDio:false,
            card_data:'',
            own_data:'',
            edit_type:'',
            pay_dio:false,
            add_list:[],
            text:'',
            pay_data:'',
            nowPos: '项目',
            xf_xm:'',
            xf_cp:'',
            xf_th:'',
            xf_cz:'',
            xf_fa:'',
            xf_ny:'',
            input: '',
            options: [{
                value: '2',
                label: '男'
            }, {
                value: '1',
                label: '女'
            }],
            calss: [{
                value: 2,
                label: '农历'
            }, {
                value: 1,
                label: '阳历'
            }],
            status: [{
                value: 1,
                label: '已婚'
            }, {
                value: 2,
                label: '未婚'
            }],
            value: '',
            birth: '',
            tableData: [{
                classify: '面部',
                name: '补水面膜',
                price: '1235',
                time: '2019-02-12',
                discount: '4折',
                dis_price: '262'
            }, {
                classify: '面部',
                name: '补水面膜',
                price: '1235',
                time: '2019-02-12',
                discount: '4折',
                dis_price: '262'
            }, {
                classify: '面部',
                name: '补水面膜',
                price: '1235',
                time: '2019-02-12',
                discount: '4折',
                dis_price: '262'
            }, {
                classify: '面部',
                name: '补水面膜',
                price: '1235',
                time: '2019-02-12',
                discount: '4折',
                dis_price: '262'
            }],

            userId: 0,
            userInfo: null,
            cpList: [],
            arrears: 0,
            total: 0,
            num: 0,
            arrears2: 0,
            itemsList: [],
            num2: 0,
            arrears3: 0,
            boxList: [],
            num3: 0,
            arrears4: 0,
            planList: [],
            coupon: [],
            card: [],
            integer: [],
            arrearsList: [],
            totalArrears: 0,
            arr: [],
            arr2: [],
            arr3: [],
            list: [],
            detail: '',
            detail2: '',
        },
        methods: {
            console(dd){
                console.log(this.edit_type);
                console.log(this.edit_m_own_dio)
                this.edit_m_own_dio=true;
                console.log(this.edit_m_own_dio)
                console.log(this.own_data)
                console.log(dd)
                this.own_data=dd
                console.log(this.own_data)
            },
            add_hel(){
                localStorage.setItem('search_sh', '')
                location.href='./health_pro.html';
            },
            send_cou(){
                $.post(url(methods.send_coupon),{id:this.send_id,mid:this.userId},v=>{
                    if(v.code==1){
                        success('赠送成功');
                        this.get_coupon_Dio=false
                        this.getCoupon()
                    }
                })
            },
            get_all_cou(){
                $.get(url(methods.getList),v=>{
                    this.con_list=v.list;
                })
            },
            getData() {
                $.post(url(methods.getNeed), {'id': this.userId}, (v)=>{
                    this.demand_list = v
                })
            },
            add_demand(){
                if(this.text != '') {
                    this.add_list.unshift(this.text);
                    this.text = '';
                }
            },
            remove(i) {
                this.add_list.splice(i, 1);
            },
            sub() {
                if(this.add_list.length == 0){
                    error('最少添加一个需求');
                    return
                }
                $.post(url(methods.addNeed), {'data':JSON.stringify(this.add_list) , id: this.userId}, (v)=>{
                    if(v.data) {
                        success('添加成功')
                        this.$confirm('添加成功,是否继续添加?', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }).then(() => {
                            this.add_list = [];
                            this.text = '';
                        }).catch(e => {
                            this.add_demand_dio=false;
                        })
                    }else{
                        error('添加失败')
                    }
                })
            },
            del_demand(id){
                if(window.confirm('是否删除？')) {
                    $.post(url(methods.delNeed), {'id': id}, (v)=>{
                        console.log(v)
                        if(v.data) {
                            this.getData()
                        }else{
                            alert('删除失败')
                        }
                    })
                }
            },
            need_close(){
                this.add_list = [];
                this.text = '';
                this.add_demand_dio=false;
            },
            modify() {
                $.post(url(methods.healthModify), {data: this.detail2.res}, v => {
                    if (v.code == 1) {
                        success(v['Msg'])
                    } else {
                        error(v['Msg'])
                    }
                    this.detail2 = ''
                    this.dialogVisible2 = false
                })
            },
            delJK(id) {
                this.$confirm('是否删除?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    $.post(url(methods.healthDel), {
                        mid: this.userId, aid: id
                    }, v => {
                        if (v.code == 1) {
                            success(v.Msg)
                            this.getDa()
                        } else {
                            error(v.error)
                        }
                    })
                }).catch(e => {

                })
            },
            bk(id) {
                localStorage.setItem('type', 2)
                localStorage.setItem('bkId', id)
                location.href = './pay_page.html'
            },
            handle(val) {
                if (val.length == 0) {
                    this.arr = []
                    return
                }
                for (let v of val) {
                    this.arr.push(v.id)
                }
            },
            handle2(val) {
                if (val.length == 0) {
                    this.arr2 = []
                    return
                }
                for (let v of val) {
                    this.arr2.push(v.id)
                }
            },
            handle3(val) {
                if (val.length == 0) {
                    this.arr3 = []
                    return
                }
                for (let v of val) {
                    this.arr3.push(v.id)
                }
            },
            edit_v_own(id){
                console.log(this.own_data);
                if(this.own_data.originally_num==''){
                    error('请输入原有次数！')
                }else if(this.own_data.current_num==''){
                    error('请输入剩余次数！')
                }else if(this.own_data.current_num>this.own_data.originally_num){
                    error('剩余次数大于原本次数！')
                }else if(this.own_data.fee==''){
                    error('请输入手工费！')
                }else{
                    $.get(url(methods.mem_own_edit),{data:this.own_data,id:id,type:this.edit_type},v=>{
                        console.log(v)
                        if(v.code==1){
                            success(v.Msg)
                        }
                    })
                }
            },
            own_cancel(){
                this.edit_m_own_dio=false;
                this.card_eDio=false;
                this.own_data='';
                this.card_data='';
            },
            card_edit(id){
                if(this.card_data.amount==''){
                    error('请输入卡内余额！')
                }else{
                    $.get(url(methods.modify_member_card_details),{data:this.card_data},v=>{
                        console.log(v)
                        if(v.code==1){
                            success(v.Msg)
                            this.card_eDio=false;
                            this.getCard()
                        }
                    })
                }
            },
            check_bulk(bulk){
               /* if(bulk<0||bulk>100){
                    error('请输入1~100之间数字！')
                }*/
            },
            card_del(id){
                this.$confirm('是否删除?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    $.post(url(methods.del_card), {id: id}, v => {
                        if (v.code == 1) {
                            success(v.Msg);
                            this.getCard();
                        }
                    })
                }).catch(e => {

                })
            },
                del(t, v, t2 = 1) {
                this.$confirm('是否删除?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    let a = []
                    if (t == 1) {
                        if (t2 == 1 && this.arr.length == 0) {
                            return
                        }
                        if (t2 == 1) {
                            a = this.arr
                        } else {
                            a.push(v.id)
                        }
                    } else if (t == 2) {
                        if (t2 == 1 && this.arr2.length == 0) {
                            return
                        }
                        if (t2 == 1) {
                            a = this.arr2
                        } else {
                            a.push(v.id)
                        }
                    } else if (t == 3) {
                        if (t2 == 1 && this.arr3.length == 0) {
                            return
                        }
                        if (t2 == 1) {
                            a = this.arr3
                        } else {
                            a.push(v.id)
                        }
                    }
                    $.post(url(methods.delWhich), {data: JSON.stringify(a), type: t}, v => {
                        if (v.code == 0) {
                            if (t == 1) {
                                this.getCp()
                            } else if (t == 2) {
                                this.getBoxItems('items')
                                this.getBoxItems('plan')
                            } else if (t == 3) {
                                this.getBoxItems('box')
                            }
                            success(v.data)
                        } else {
                            error(v.msg)
                        }
                    })
                }).catch(e => {

                })
            },
            jump() {
                location.href = './buy.html'
            },
            getArrears() {
                this.totalArrears = 0
                $.get(url(methods.aloneArrears) + `&mid=${this.userId}`, v => {
                    this.arrearsList = v.list
                    for (let x of v.list) {
                        this.totalArrears += parseFloat(x.money)
                    }
                })
            },
            getIntegral() {
                $.get(url(methods.integralRecord) + `&mid=${this.userId}`, v => {
                    this.integer = v.record
                })
            },
            formatter2(r, c) {
                if (r.bir_type == 1) {
                    return '赠送'
                } else {
                    return '划扣'
                }
            },
            formatter(r, c) {
                if (r.card_type == 1) {
                    return '储值卡'
                } else if (r.card_type == 2) {
                    return '普通折扣卡'
                }else  if (r.card_type == 3){
                    return "全场折扣卡"
                }
            },
            getCard() {
                $.get(url(methods.cardList) + `&mid=${this.userId}`, v => {
                    this.card = v.res
                })
            },
            getCoupon() {
                $.get(url(methods.ajax_have_coupon), {mid: this.userId}, v => {
                    console.log(v)
                    this.coupon = v.res
                })
            },
            handleClick(tab, event) {
                if (tab.index == 0) {
                    this.getDetail()
                } else if (tab.index == 1) {
                    this.getCp()
                } else if (tab.index == 2) {
                    this.getBoxItems('items')
                } else if(tab.index == 3) {
                    this.getBoxItems('plan')
                } else if (tab.index == 4) {
                    this.getBoxItems('box')
                } else if (tab.index == 5) {
                    this.getCoupon()
                } else if (tab.index == 6) {
                    this.getCard()
                }else if (tab.index == 7) {
                    this.getArrears()
                } else if (tab.index == 8) {
                    this.getDa()
                }else if (tab.index == 9) {
                    this.get_consumption()
                }
               /* else if (tab.index == 7) {
                    this.getIntegral()
                }*/
            },
            get_consumption(){
                $.get(url(methods.get_consumption),{mid:this.userId},v=>{
                    //项目
                    this.xf_xm = v.res.project;
                    //产品
                    this.xf_cp = v.res.product;
                    //套盒
                    this.xf_th = v.res.box;
                    //充值
                    this.xf_cz = v.res.card;
                    //方案
                    this.xf_fa = v.res.programme;
                    //内衣
                    this.xf_ny=v.res.underwear;
                })
            },
            getDa() {
                $.get(url(methods.healthList) + `&mid=${this.userId}`, v => {
                    if (v.code == 1) {
                        this.list = v.list
                    }
                })
            },
            getJK(id) {
                this.dialogVisible = true
                $.post(url(methods.healthDetail), {
                    mid: this.userId, id: id
                }, v => {
                    if (v.code == 1) {
                        this.detail = v.res
                    }
                })
            },
            getJK2(id) {
                this.dialogVisible2 = true
                $.post(url(methods.healthDetail), {
                    mid: this.userId, id: id
                }, v => {
                    if (v.code == 1) {
                        this.detail2 = v.res
                    }
                })
            },
            getBoxItems(t) {
                $.get(url(methods.boxItems) + `&mid=${this.userId}&type=${t}`, v => {
                    if (v.code == 1) {
                        if (t == 'items') {
                            this.num = v.res.total_num
                            this.itemsList = v.res.list
                            this.arrears2 = v.res.total_arrears
                        } else if(t == 'box') {
                            this.num2 = v.res.total_num
                            this.boxList = v.res.list
                            this.arrears3 = v.res.total_arrears
                        } else if(t == 'plan') {
                            this.num3 = v.res.total_num
                            this.planList = v.res.list
                            this.arrears4 = v.res.total_arrears
                        }
                    } else {
                        error('请求出错')
                    }
                })
            },
            getCp() {
                $.post(url(methods.haveProductList), {mid: this.userId}, v => {
                    if (v.code == 1) {
                        let t = 0
                        for (let x of v.res.list) {
                            t += x.sum * x.price
                        }
                        this.total = t
                        this.cpList = v.res.list
                        this.arrears = v.res.arrears
                    } else {
                        error('请求出错')
                    }
                })
            },
            modifyUser() {
                if (this.userInfo.name == '' || this.userInfo.tel == '') {
                    error('请填些姓名和电话')
                    return
                }
                $.post(url(methods.editUser), {
                    data: {
                        name: this.userInfo.name,
                        tel: this.userInfo.tel,
                        address: this.userInfo.address,
                        id: this.userInfo.id,
                        bir_type: this.userInfo.bir_type,
                        birthday: this.userInfo.yl,
                        marital: this.userInfo.marital,
                        sex: this.userInfo.sex,
                        balance: this.userInfo.balance,
                        send_balance: this.userInfo.send_balance,
                        shop_num: this.userInfo.shop_num,
                    }
                }, v => {
                    if (v.code == 1) {
                        success(v.Msg)
                    } else {
                        error(v.errorMsg)
                    }
                })
            },
            getDetail() {
                $.get(url(methods.userInfo) + `&id=${this.userId}`, v => {
                    if (v.code == 0) {
                        v.data.sex = v.data.sex.toString()
                        this.userInfo = v.data
                    } else {
                        error('请求出错')
                    }
                })
            },
        },
        mounted() {
            this.$nextTick(e => {
                //初始化
                that = this;
                loginState()
                this.userId = localStorage.getItem('user_id')
                this.getDetail()
                this.getDa()
                this.getData()
            })
        }
    })
</script>